<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:Class="PupilTrack.HGNTestPage"
    Title="HGN Test Page"
    BackgroundColor="#182330">

    <Grid>
        <!-- Main Content -->
        <ScrollView>
            <StackLayout x:Name="MainContent" Padding="20" Spacing="15">
                <!-- Camera and Record Button Overlay -->
                <Grid HorizontalOptions="Center" WidthRequest="300" HeightRequest="400">
                    <!-- Camera View -->
                    <toolkit:CameraView x:Name="CameraViewControl"
                                        WidthRequest="300"
                                        HeightRequest="400"
                                        BackgroundColor="Black"
                                        MediaCaptured="MyCamera_MediaCaptured" />

                    <Button x:Name="RecordButton"
                            BackgroundColor="Red"
                            TextColor="White"
                            FontSize="30"
                            WidthRequest="40"
                            HeightRequest="40"
                            CornerRadius="40"
                            BorderColor="White"
                            BorderWidth="3"
                            HorizontalOptions="Center"
                            VerticalOptions="End"
                            Margin="0,0,0,20"
                            Clicked="OnRecordButtonClicked" />
                </Grid>

                <!-- Video WebView (for playing back recorded video) -->
                <WebView x:Name="VideoWebView"
                         IsVisible="False"
                         HeightRequest="300"
                         WidthRequest="400"/>

                <!-- Upload Video Button -->
                <Button Text="Select Video"
                        Clicked="OnSelectVideoButtonClicked"
                        HorizontalOptions="Center"
                        BackgroundColor="White"
                        TextColor="Black"
                        FontAttributes="Bold"
                        CornerRadius="10"  />

                <!-- Status Message -->
                <Label x:Name="StatusLabel"
                       Text="Please select or record a video to upload"
                       HorizontalOptions="Center"
                       TextColor="White"
                       FontSize="16" />

                <!-- Progress Indicator (if needed outside the overlay) -->
                <ActivityIndicator x:Name="ProgressIndicator"
                                   IsRunning="False"
                                   IsVisible="False"
                                   HorizontalOptions="Center" />

                <!-- Download Label -->
                <Label x:Name="DownloadLabel"
                       Text=""
                       FontSize="14"
                       TextColor="Gray"
                       HorizontalOptions="Center"
                       IsVisible="False" />

                <!-- Download Button -->
                <Button x:Name="DownloadButton"
                        Text="Download Stabilized Video"
                        HorizontalOptions="Center"
                        IsVisible="False"
                        BackgroundColor="White"
                        TextColor="Black"
                        CornerRadius="10"
                        Clicked="OnDownloadButtonClicked" />
            </StackLayout>
        </ScrollView>

        <!-- Loading Overlay (initially hidden) -->
        <Grid x:Name="LoadingOverlay" BackgroundColor="Black" Opacity="0.8" IsVisible="False">
            <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                <ActivityIndicator IsRunning="True" Color="White" />
                <Label Text="Processing video, please wait..." 
                       TextColor="White"
                       HorizontalOptions="Center" />
            </StackLayout>
        </Grid>
    </Grid>
</ContentPage>