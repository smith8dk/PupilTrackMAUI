<?xml version="1.0" encoding="utf-8" ?>
<ContentPage  
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:local="clr-namespace:PupilTrack.Converters"
    x:Class="PupilTrack.HGNResultsPage" 
    BackgroundColor="#1A1F26">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Converters for formatting and icon selection -->
            <local:SecondsToStringConverter x:Key="SecondsToStringConverter" />
            <local:PlayPauseIconConverter x:Key="PlayPauseIconConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <Grid Padding="15">
            <Grid.RowDefinitions>
                <!-- Row 0: Video Player -->
                <RowDefinition Height="220" />
                <!-- Row 1: Video Slider -->
                <RowDefinition Height="40" />
                <!-- Row 2: Position/Duration Labels (Moved Above Playback Controls) -->
                <RowDefinition Height="40" />
                <!-- Row 3: Playback Controls (Moved Below Timestamp Labels) -->
                <RowDefinition Height="60" />
                <!-- Row 4: Sudden Movement Counter -->
                <RowDefinition Height="Auto" />
                <!-- Row 5: Sudden Movement Timestamps -->
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- MediaElement for Video Playback -->
            <toolkit:MediaElement
                x:Name="VideoPlayer"
                Grid.Row="0"
                ShouldAutoPlay="False"
                ShouldShowPlaybackControls="False"
                MediaEnded="OnMediaEnded"
                MediaFailed="OnMediaFailed"
                MediaOpened="OnMediaOpened"
                PositionChanged="OnPositionChanged"
                SeekCompleted="OnSeekCompleted"
                BackgroundColor="Black" />

            <!-- Video Position Slider (Above Labels & Buttons) -->
            <AbsoluteLayout Grid.Row="1" HeightRequest="40">
                <Slider x:Name="PositionSlider"
                        AbsoluteLayout.LayoutBounds="0,0,1,1"
                        AbsoluteLayout.LayoutFlags="All"
                        MinimumTrackColor="Gray"
                        DragStarted="Slider_DragStarted"
                        DragCompleted="Slider_DragCompleted" />
                <AbsoluteLayout x:Name="MarkerContainer"
                                AbsoluteLayout.LayoutBounds="0,0,1,1"
                                AbsoluteLayout.LayoutFlags="All" />
            </AbsoluteLayout>

            <!-- Position and Duration Labels (Now Above Playback Buttons) -->
            <Grid Grid.Row="2" Padding="10">
                <Label HorizontalOptions="Start"
                       Text="{Binding Position, Source={x:Reference VideoPlayer}, Converter={StaticResource SecondsToStringConverter}}"
                       TextColor="White" />
                <Label HorizontalOptions="End"
                       Text="{Binding Duration, Source={x:Reference VideoPlayer}, Converter={StaticResource SecondsToStringConverter}}"
                       TextColor="White" />
            </Grid>

            <!-- Unified White Oval for Playback Controls (Now at the Bottom) -->
            <Frame Grid.Row="3"
                   BackgroundColor="White"
                   CornerRadius="30"
                   HasShadow="False"
                   Padding="15"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   WidthRequest="220"
                   HeightRequest="60">
                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="40">
                    <!-- Rewind Button -->
                    <ImageButton Grid.Column="0"
                                 Clicked="OnSeekBackwardClicked"
                                 WidthRequest="45"
                                 HeightRequest="45"
                                 BackgroundColor="Transparent"
                                 Source="forward_icon.png"
                                 ScaleX="-1" />
                    <!-- Play/Pause Button -->
                    <ImageButton Grid.Column="1"
                                 Clicked="OnPlayPauseClicked"
                                 WidthRequest="45"
                                 HeightRequest="45"
                                 BackgroundColor="Transparent"
                                 Source="{Binding CurrentState, Source={x:Reference VideoPlayer}, Converter={StaticResource PlayPauseIconConverter}}" />
                    <!-- Forward Button -->
                    <ImageButton Grid.Column="2"
                                 Clicked="OnSeekForwardClicked"
                                 WidthRequest="45"
                                 HeightRequest="45"
                                 BackgroundColor="Transparent"
                                 Source="forward_icon.png" />
                </Grid>
            </Frame>

            <!-- Sudden Movement Counter Label -->
            <Label x:Name="MovementCounterLabel"
                   Grid.Row="4"
                   Text="Sudden Movements: 0"
                   FontSize="20"
                   TextColor="White"
                   HorizontalOptions="Center" />

            <!-- Sudden Movement Timestamps Label -->
            <Label x:Name="MovementTimestampsLabel"
                   Grid.Row="5"
                   Text="Timestamps:"
                   FontSize="16"
                   TextColor="White"
                   HorizontalOptions="Center"
                   LineBreakMode="WordWrap" />
        </Grid>
    </ScrollView>
</ContentPage>
